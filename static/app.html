<html>
	<head>
		<title>Abbey Node Demo</title>
		<link rel="stylesheet" href="css/reset.css" />
		<link rel="stylesheet" href="css/style.css" />
		<script src="/socket.io/socket.io.js" type="text/javascript"></script>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js" type="text/javascript"></script>
    <script src="app.js" type="text/javascript"></script>
		<script type="text/javascript">
			var playerId = null;
			var stageId = null;
			var instrument = null;
			var song = null;
			var socket = null;
		
			$(function() {
				var isAndroid = window.location.hash == "#android";
				
				var payload = {name: "yusuf"};
				if(isAndroid) payload["instrument"] = "special";
				
				$.ajax({
					type: "POST",
					url: "/api/init",
					dataType: "json",
					data: payload,
					
					success: function(json) {
						playerId = json.playerId;
						stageId = json.stageId;
						instrument = json.instrument;
						song = json.song;
						ready();
					}
				});
			});
			
			function msg(name) {
				socket.emit(name, {
					playerId: playerId,
					stageId: stageId
				});
			}
			
			var calls = 0;
			function periodic() {
				if(calls == 3) {
					msg("abbey-node/player/done"); 
				} else {
					msg("abbey-node/player/oops");
				}
				
				calls += 1;
				if(calls < 4) setTimeout(periodic, 1000);
			}
			
			function ready() {
				console.log("ready:", playerId, stageId, instrument, song);
				
				socket = io.connect();
			
				socket.on('connect', function() {
					msg("abbey-node/player/ready");
				});

				socket.on('abbey-node/stage/ready', function(msg) {
					console.log('stage ready:', msg);
					setTimeout(periodic, 1000);
				});
				
				socket.on('abbey-node/player/oops', function(msg) {
					console.log('oops:', msg);
				});
			}
		</script>
	</head>
	<body id="player">
		<div id="navBar">
			<a href="index.html">
				<img src="img/logo.png" alt="" />
			</a>
			<ul>
				<li>Profile</li>
				<li>Options</li>
				<li>Save Track</li>
			</ul>
		</div>
		
		<div id="music">
			
			<div id="musicTrack">
				<div id="mst_menu">
					<ul>
						<li>How to Play</li>
						<li>Keyboard Guide</li>
						<li>Connect with Friends</li>
					</ul>
				</div>
				
				<h1>Don't Stop Believin'</h1>
				<h2>Journey</h2>

				<div id="mst_options">
					<h1>Your Track</h1>
				</div>
				<div id="mst_keys">
					<ul>
						<li></li>
						<li></li>
						<li></li>
						<li></li>
						<li></li>
					</ul>
				</div>
				<div id="mst_notes_lines">
					<ul>
						<li></li>
						<li></li>
						<li></li>
						<li></li>
						<li></li>
					</ul>
				</div>
				<div id="mst_notes"></div>
			</div>
			
			<div id="musicFriends">
				
				<div class="frBody">
					<div class="frHead"></div>
					<div class="frInstrument"></div>
					<div class="frName">Chris</div>
				</div>
				
				<div class="frBody" style="background: green">
					<div class="frHead"></div>
					<div class="frInstrument"></div>
					<div class="frName">Rich</div>
				</div>
				
				<div class="frBody" style="background: teal">
					<div class="frHead"></div>
					<div class="frInstrument"></div>
					<div class="frName">Yusuf</div>
				</div>
				
				<div class="addFr">
					Invite a Friend
				</div>
				
			</div>
			
			<div id="musicAvatar">
				<div id="mav_shadow"></div>
				<div id="mav_body">
					<img id="mav_instrument" src="img/guitar.png" alt="" />
					<div id="mav_head">
						<img id="mvh-sg" src="img/sunglasses.png" style="display: none; top: 25px; left: 5px" />
					</div>
					<div class="mav_hand" id="mvh_left"></div>
					<div class="mav_hand" id="mvh_right"></div>
				</div>
				<h1>Brian</h1>
				<div id="mav_dress">
					<input type="text" id="mav_name" placeholder="Choose a Name"/>
					<ul>
						<li></li>
						<li></li>
						<li></li>
						<li></li>
						<li></li>
						<li></li>
					</ul>
				</div>
			</div>
			
		</div>
		
		<div id="optionBar">
			<div id="optTimer">
				00:10:00
			</div>
		</div>
	</body>
</html>
